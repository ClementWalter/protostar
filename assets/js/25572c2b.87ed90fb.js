"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[310],{3905:function(e,t,n){n.d(t,{Zo:function(){return m},kt:function(){return u}});var i=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=i.createContext({}),l=function(e){var t=i.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},m=function(e){var t=l(e.components);return i.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},p=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,c=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),p=l(n),u=a,g=p["".concat(c,".").concat(u)]||p[u]||d[u]||r;return n?i.createElement(g,o(o({ref:t},m),{},{components:n})):i.createElement(g,o({ref:t},m))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=p;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var l=2;l<r;l++)o[l]=n[l];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}p.displayName="MDXCreateElement"},5360:function(e,t,n){n.d(t,{Z:function(){return k}});var i=n(7294),a=n(9960),r=n(3725),o=n(6010),s="cardContainer_woeA",c="cardContainerLink_iOSj",l="cardTitle_pNjP",m="cardDescription_qC_k",d=n(3919),p=n(5999);function u(e){var t=e.href,n=e.children,r=(0,o.Z)("card margin-bottom--lg padding--lg",s,t&&c);return t?i.createElement(a.Z,{href:t,className:r},n):i.createElement("div",{className:r},n)}function g(e){var t=e.href,n=e.icon,a=e.title,r=e.description;return i.createElement(u,{href:t},i.createElement("h2",{className:(0,o.Z)("text--truncate",l),title:a},n," ",a),i.createElement("div",{className:(0,o.Z)("text--truncate",m),title:r},r))}function h(e){var t=e.item,n=(0,r.Wl)(t);return i.createElement(g,{href:n,icon:"\ud83d\uddc3\ufe0f",title:t.label,description:(0,p.I)({message:"{count} items",id:"theme.docs.DocCard.categoryDescription",description:"The default description for a category card in the generated index about how many items this category includes"},{count:t.items.length})})}function f(e){var t,n=e.item,a=(0,d.Z)(n.href)?"\ud83d\udcc4\ufe0f":"\ud83d\udd17",o=(0,r.xz)(null!=(t=n.docId)?t:void 0);return i.createElement(g,{href:n.href,icon:a,title:n.label,description:null==o?void 0:o.description})}function v(e){var t=e.item;switch(t.type){case"link":return i.createElement(f,{item:t});case"category":return i.createElement(h,{item:t});default:throw new Error("unknown item type "+JSON.stringify(t))}}function k(e){var t=e.items;return i.createElement("div",{className:"row"},t.map((function(e,t){return i.createElement("article",{key:t,className:"col col--6"},i.createElement(v,{item:e}))})))}},6446:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return m},default:function(){return h},frontMatter:function(){return l},metadata:function(){return d},toc:function(){return u}});var i=n(7462),a=n(3366),r=(n(7294),n(3905)),o=n(5360),s=n(3725),c=["components"],l={sidebar_label:"Migrations"},m="Migrations",d={unversionedId:"tutorials/deploying/migrations/README",id:"tutorials/deploying/migrations/README",title:"Migrations",description:"This feature is actively developed. Many new additions or changes will land in future Protostar releases.",source:"@site/docs/tutorials/06-deploying/02-migrations/README.md",sourceDirName:"tutorials/06-deploying/02-migrations",slug:"/tutorials/deploying/migrations/",permalink:"/protostar/docs/tutorials/deploying/migrations/",editUrl:"https://github.com/software-mansion/protostar/tree/master/website/docs/tutorials/06-deploying/02-migrations/README.md",tags:[],version:"current",frontMatter:{sidebar_label:"Migrations"},sidebar:"tutorials",previous:{title:"CLI",permalink:"/protostar/docs/tutorials/deploying/cli"},next:{title:"declare",permalink:"/protostar/docs/tutorials/deploying/migrations/declare"}},p={},u=[{value:"Creating a migration file",id:"creating-a-migration-file",level:2},{value:"Migration file structure",id:"migration-file-structure",level:2},{value:"Running the migration",id:"running-the-migration",level:2},{value:"Available migration cheatcodes",id:"available-migration-cheatcodes",level:2}],g={toc:u};function h(e){var t=e.components,n=(0,a.Z)(e,c);return(0,r.kt)("wrapper",(0,i.Z)({},g,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"migrations"},"Migrations"),(0,r.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"This feature is actively developed. Many new additions or changes will land in future Protostar releases."))),(0,r.kt)("p",null,"Migrations are Cairo files that help you manage contracts on the StarkNet. They are especially useful, when your project consists of multiple contracts. Migration code is mainly written in hints. Protostar injects special functions into hints' scope, which you can use to interact with the StarkNet. These functions are similar to cheatcodes used to test contracts, hence in this document we will refer to these functions as migration cheatcodes."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Protostar aims to make migration cheatcodes a subset of ",(0,r.kt)("a",{parentName:"p",href:"/docs/tutorials/testing/cheatcodes"},"testing cheatcodes")," in order to allow testing migration scripts against Protostar's local StarkNet."))),(0,r.kt)("h2",{id:"creating-a-migration-file"},"Creating a migration file"),(0,r.kt)("p",null,"You can create a migration file anywhere, but we recommend creating them inside a ",(0,r.kt)("inlineCode",{parentName:"p"},"migrations")," directory. Currently, Protostar doesn't enforce any naming convention for migration files. In this tutorial we use a naming convention: ",(0,r.kt)("inlineCode",{parentName:"p"},"migration_NUMBER_TITLE.cairo"),", for example ",(0,r.kt)("inlineCode",{parentName:"p"},"migration_01_init.cairo"),"."),(0,r.kt)("h2",{id:"migration-file-structure"},"Migration file structure"),(0,r.kt)("p",null,"Each migration should have 2 functions: ",(0,r.kt)("inlineCode",{parentName:"p"},"up")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"down"),". The ",(0,r.kt)("inlineCode",{parentName:"p"},"up")," function is responsible to migrate your project forward, and the ",(0,r.kt)("inlineCode",{parentName:"p"},"down"),"function is executed to rollback changes. These functions must be decorated with ",(0,r.kt)("inlineCode",{parentName:"p"},"@external")," decorator."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="Declaring contract in migration file"',title:'"Declaring',contract:!0,in:!0,migration:!0,'file"':!0},'%lang starknet\n\n@external\nfunc up():\n    %{ declare("./build/main.json") %}\n    return ()\nend\n\n@external\nfunc down():\n    %{ assert False, "Not implemented" %}\n    return ()\nend\n\n')),(0,r.kt)("h2",{id:"running-the-migration"},"Running the migration"),(0,r.kt)("p",null,"To run the migration execute the ",(0,r.kt)("inlineCode",{parentName:"p"},"migrate")," command. We recommend specifying the migration output directory to save class hashes and contract addresses."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text",metastring:'title="Running the migration to the testnet"',title:'"Running',the:!0,migration:!0,to:!0,'testnet"':!0},"$ protostar migrate migrations/migration_01_init.cairo\n                    --network alpha-goerli\n                    --output-dir migrations/testnet\n")),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Run ",(0,r.kt)("inlineCode",{parentName:"p"},"protostar migrate --help")," to display all parameters supported by this command."))),(0,r.kt)("p",null,"Protostar asks, if you build the project to prevent you from running the migration on an outdated build output."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text",metastring:"title=\"Type 'y' to continue\"",title:'"Type',"'y'":!0,to:!0,'continue"':!0},"Did you build the project before running this command? [y/n]: \n")),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Run ",(0,r.kt)("inlineCode",{parentName:"p"},"protostar migrate")," with the ",(0,r.kt)("inlineCode",{parentName:"p"},"--no-confirm")," flag to skip this check."))),(0,r.kt)("p",null,"If you build the project, Protostar will print migration logs in the command line."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text",metastring:'title="You can use this output for the debugging purposes"',title:'"You',can:!0,use:!0,this:!0,output:!0,for:!0,the:!0,debugging:!0,'purposes"':!0},"[INFO] (Protostar \u2192 StarkNet) DECLARE\n  contract             /.../protostar/playground/standard/build/main.json\n  sender_address       1\n  max_fee              0\n  version              0\n  signature            []\n  nonce                0\n[INFO] (Protostar \u2190 StarkNet) DECLARE\n  code                 TRANSACTION_RECEIVED\n  class_hash           123456...\n  transaction_hash     0x1234...\n[INFO] Migration completed\n")),(0,r.kt)("h2",{id:"available-migration-cheatcodes"},"Available migration cheatcodes"),(0,r.kt)(o.Z,{items:(0,s.jA)().items,mdxType:"DocCardList"}))}h.isMDXComponent=!0}}]);